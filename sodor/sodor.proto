syntax = "proto3";

option go_package = "github.com/BabySid/proto/sodor";

service FatController {
  rpc CreateJob (Job) returns (JobReply) {}
}

message JobReply {
  int64 id = 1;
}

enum TaskState {
  TS_INIT = 0;
  TS_RUNNING = 1;
  TS_STOPPED = 2;
}

enum SchedulerMode {
  SM_Null = 0;
  SM_None = 1;
  SM_Crontab = 2;
}

message RoutineSpec {
  string ct_spec = 1;
}

enum HostType {
  HT_Null = 0;
  HT_IP = 1;
  HT_Tag = 2;
}

message Host {
  HostType type = 1;
  repeated string nodes = 2;
}

message Task {
  int32  id = 1;
  int32 create_at = 2;
  int32 update_at = 3;
  int32 job_id = 4;
  string name = 5;
  repeated Host running_hosts = 6;
  SchedulerMode scheduler_mode = 7;
  RoutineSpec routine_spec = 8;
  string script = 9;
  int32 running_timeout = 10;
}

message Job {
  int32  id = 1;
  int32 create_at = 2;
  int32 update_at = 3;
  string name = 4;
  repeated Task tasks = 5;
  repeated TaskRelation relations = 6;
}

message Jobs {
  repeated Job jobs = 1;
}

message TaskRelation {
  string from_task = 1;
  string to_task = 2;
}

message AlertGroup {
  int32  id = 1;
  int32 create_at = 2;
  int32 update_at = 3;
  string name = 4;
  repeated int64 plugin_ids = 5;
}

message AlertPluginParam {

}

message AlertPlugin {
  int32  id = 1;
  int32 create_at = 2;
  int32 update_at = 3;
  string catalog = 4;
  AlertPluginParam params = 5;
}

message AlertHistory {
  int32  id = 1;
  int32 create_at = 2;
  int32 update_at = 3;
}